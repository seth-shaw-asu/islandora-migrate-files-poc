id: claw_image
label: Import CDM Images
migration_group: test_digital

migration_dependencies:
  required:
    - claw_media
    # Loading authorities first allows us to look them up
    - auth_person
    - auth_complex
    - auth_geographic
    - auth_topic

source:
  plugin: csv
  path: 'data/apollo.csv' # Path relative to Drupal site root
  delimiter: ','
  header_row_count: 1 # headers, 0 if there are no headers
  keys:
    - digital_id
  constants:
    collection_alias: 'apollo'
  column_names:
    0:
      digital_id: 'Digital ID'
    1:
      title: 'Title'
    2:
      date: 'Date' # Ignoring for now.
    3:
      location: 'Location' # Ignoring for now.
    4:
      subjects: 'Subjects'
    5:
      description: 'Description'
    6:
      file: 'File'

destination: # We're creating nodes, ya'll.
  plugin: entity:node

process:
  type: # The content type of the nodes we are creating
    plugin: default_value
    default_value: unlv_image

  # One-to-One mappings
  field_digital_id: digital_id
  title: title
  field_description: description

  path: # Path Alias
    plugin: concat
    delimiter: '/'
    source:
      - '' # Gives us a '/' prefix for the server root
      - constants/collection_alias
      - digital_id

  # SUBJECTS
  # For subjects we can't find in the system, we can't determine by their value
  # if they should be persons, corporate, families, or topics. This defaults to
  # creating them as subject nodes (topics). We may opt for NOT creating them
  # and reporting out the issue at a later time, if that makes sense.

  field_subjects: # Temporary field of subjects
    -
      plugin: skip_on_empty
      source: subjects
      method: process
    -
      plugin: explode
      delimiter: ';'
    -
      plugin: entity_generate # Create a subject entity if it doesn't already exist
      default_values:
        type: subject

  # Now the TIFF entity references
  field_tiff/target_id:
    plugin: migration_lookup
    migration: claw_media
    source: digital_id
    no_stub: true
  field_tiff/alt: title
